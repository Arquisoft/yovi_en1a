ifndef::imagesdir[:imagesdir: ../images]

[[section-deployment-view]]
== Deployment View

=== Infrastructure Level 1: Azure Cloud Environment

The high-level deployment consists of an Azure Virtual Machine hosting the containerized backend services. The frontend is a React application delivered to the user's web browser.

[plantuml, level1-whitebox, svg]
----
@startuml
title YOVI Deployment Diagram - Level 1

skinparam componentStyle uml2
left to right direction

node "User Device" <<device>> {
    node "Web Browser" <<execution environment>> {
        component [Webapp] as webapp <<React>>
    }
}

node "Ubuntu Linux - Azure VM" <<device>> {
    node "Docker Engine" <<runtime>> {
        component [User Service] as usersvc <<Node.js>>
        component [GameY Engine] as gamey <<Rust>>
    }
}

webapp --> usersvc : "JSON/HTTP :3000"
webapp --> gamey : "JSON/YEN :4000"
@enduml
----

Motivation::
The YOVI system is hosted on **Microsoft Azure** using an IaaS model. This allows the system to run the high-performance Rust GameY Engine and the Node.js User Service in a unified Ubuntu environment, ensuring low latency between the game logic and the data management layer.

Quality and/or Performance Features::
* **Performance:** The Rust-based GameY Engine provides native execution speed for strategy generation and win verification.
* **Accessibility:** Services are exposed directly via their respective ports to allow bot interaction and direct Webapp communication.
* **Flexibility:** Azure provides the vertical scaling necessary to handle greater board sizes than during complex game simulations.

Mapping of Building Blocks to Infrastructure::
[cols="1,2,2"]
|===
|Building Block |Infrastructure Element |Description

|**Webapp**
|User Web Browser
|Client-side application providing the UI for Game Y.

|**User Service**
|Node.js Container
|Handles user registration, participation history, and win/loss statistics.

|**GameY Engine**
|Rust Container
|Core logic for win verification and move suggestion via YEN notation.
|===

'''

=== Infrastructure Level 2: Organization in Containers (Docker)

This level describes how the internal components are isolated within the Ubuntu host to manage specific runtime dependencies.

[plantuml, level2-docker, svg]
----
@startuml
title Level 2 - Docker Execution Environment

node "Docker Host (Ubuntu)" {

    node "yovi-network" <<network>> {
        component "WebApp Container" as nodejs {
            portout 3000
        }
        component "GameY Container" as rust {
            portout 4000
        }
    }
}

node "Prometheus" as mon <<container>>

rust ..> mon : "Metrics :9091"
nodejs ..> mon : "Metrics :9090"
@enduml
----

Motivation::
Docker ensures that the Rust toolchain and Node.js environment are encapsulated. This prevents version conflicts on the Azure host and simplifies the pipeline by ensuring the same image is used for testing and production.

Quality and/or Performance Features::
* **Isolation:** If a specific Game Y strategy causes a memory leak in the engine, the Docker container limits prevent it from affecting the availability of the User Service.
* **Observability:** Each container exposes a dedicated monitoring port to track performance metrics as required by the evaluation criteria.
* **Portability and Dependency Management**: By using Docker to containerize the services, the system can run the Rust-based GameY Engine and Node.js User Service on any infrastructure (like the Azure VM) without requiring the host machine to have those specific runtimes or compilers installed manually. This ensures a consistent execution environment across development and production.



'''

=== Infrastructure Level 3: Data Persistence

Motivation::
To satisfy the requirement of consulting participation history and metrics, a persistent storage layer is mapped to the Docker environment.

[cols="1,2"]
|===
|Element |Storage Strategy

|**User Profiles & Stats**
|Docker Volume mapped to the host filesystem to ensure participation data survives container restarts.

|**Move History**
|Standardized logging within the GameY container for audit trails of YEN notation states.
|===

'''

=== Network and Connectivity

The following port configuration defines the boundaries and communication paths within the Ubuntu Virtual Machine:

* **Internal/External Service Ports:**
** **Port 80:** The public access for the Webapp containing Game Y.
** **Port 3000:** The Webapp and external Bots communicate with the User Service for identity and statistics management.
** **Port 4000:** The Webapp and external Bots send game moves to the GameY Engine using the **JSON/YEN protocol**.
* **Monitoring:**
** **Port 9090/9091:** Reserved for internal monitoring (Prometheus/Grafana) to track the health of the host and the individual microservices.

image::07_vm_ports.png[Network Port Mapping]